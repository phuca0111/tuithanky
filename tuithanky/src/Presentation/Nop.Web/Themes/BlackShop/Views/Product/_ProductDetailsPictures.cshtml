@model ProductDetailsModel
@using Nop.Core.Domain.Common
@using Nop.Core
@inject IWorkContext workContext
@inject CommonSettings commonSettings
@{
    <script asp-exclude-from-bundle="true" src="/Themes/BlackShop/Content/js/magnific-popup.js" asp-location="Footer"></script>
    <script asp-exclude-from-bundle="true" src="/Themes/BlackShop/Content/fancybox/jquery.fancybox.js" asp-location="Footer"></script>
    <script asp-exclude-from-bundle="true" src="/Themes/BlackShop/Content/js/xzoom.min.js" asp-location="Footer"></script>
    <link rel="stylesheet" href="/Themes/BlackShop/Content/fancybox/jquery.fancybox.css" />
    <link rel="stylesheet" href="/Themes/BlackShop/Content/css/magnific-popup.css" />
    <link rel="stylesheet" href="/Themes/BlackShop/Content/css/xzoom.css" />
}
<div class="gallery" id="fancy">
    @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.ProductDetailsBeforePictures, additionalData = Model })
    <div class="picture" id="xzoom-@Model.Id">
        @if (Model.DefaultPictureZoomEnabled && Model.PictureModels.Count > 0)
        {
            <img class="xzoom" id="xzoom-fancy-@Model.Id" alt="@Model.DefaultPictureModel.AlternateText" src="@Model.DefaultPictureModel.FullSizeImageUrl" xoriginal="@Model.DefaultPictureModel.FullSizeImageUrl" title="@Model.DefaultPictureModel.Title" />


        }
        else
        {
            <img class="xzoom" alt="@Model.DefaultPictureModel.AlternateText" src="@Model.DefaultPictureModel.FullSizeImageUrl" xoriginal="@Model.DefaultPictureModel.FullSizeImageUrl" title="@Model.DefaultPictureModel.Title" />
        }
    </div>
    @if (Model.PictureModels.Count > 0 && Model.DefaultPictureZoomEnabled)
    {
        <div class=" xzoom-thumbs picture-thumbs bs_product_pic_slider" id="thumb-@Model.Id">
            @foreach (var picture in Model.PictureModels)
            {
                <a class="thumb-item" href="@picture.FullSizeImageUrl" alt="@picture.AlternateText" title="@picture.Title">
                    <img class="xzoom-gallery" src="@picture.ThumbImageUrl" alt="@picture.AlternateText" title="@picture.Title" xpreview="@picture.FullSizeImageUrl" />
                </a>
            }
        </div>
        @if (Model.PictureModels.Count > 4)
        {
            <script asp-location="Footer">
                $(".bs_product_pic_slider").slick({
                infinite: !0,
                slidesToShow: 4,
                vertical: true,
                verticalSwiping: true,
                slidesToScroll: -1,
                rtl: @((await workContext.GetWorkingLanguageAsync()).Rtl.ToString().ToLower()),
                slidesToScroll: 1,
                responsive: [{
                        breakpoint: 1025,
                            settings: {
                                slidesToShow: 4,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }, {
                        breakpoint: 769,
                            settings: {
                                slidesToShow: 4,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }, {
                        breakpoint: 576,
                            settings: {
                                slidesToShow: 3,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        },{
                        breakpoint: 400,
                            settings: {
                                slidesToShow: 2,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }]
            });
            </script>
        }
    }
    else
    {
        if (Model.PictureModels.Count > 0)
        {
            <div class=" xzoom-thumbs picture-thumbs bs_product_pic_slider">
                @foreach (var picture in Model.PictureModels)
                {
                    <a class="thumb-item" href="@picture.FullSizeImageUrl" alt="@picture.AlternateText" title="@picture.Title">
                        <img class="xzoom-gallery" src="@picture.ThumbImageUrl" alt="@picture.AlternateText" title="@picture.Title" xpreview="@picture.FullSizeImageUrl" />
                    </a>
                }
            </div>
            @if (Model.PictureModels.Count > 4)
            {
                <script asp-location="Footer">
                $(".bs_product_pic_slider").slick({
                infinite: !0,
                slidesToShow: 4,
                vertical: true,
                verticalSwiping: true,
                slidesToScroll: -1,
                rtl: @((await workContext.GetWorkingLanguageAsync()).Rtl.ToString().ToLower()),
                slidesToScroll: 1,
                responsive: [{
                        breakpoint: 1025,
                            settings: {
                                slidesToShow: 4,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }, {
                        breakpoint: 769,
                            settings: {
                                slidesToShow: 4,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }, {
                        breakpoint: 576,
                            settings: {
                                slidesToShow: 3,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        },{
                        breakpoint: 400,
                            settings: {
                                slidesToShow: 2,
                                vertical: false,
                                verticalSwiping: false,
                                slidesToScroll: -1,
                                slidesToScroll: 1
                            }
                        }]
            });
                </script>
            }

        }
    }
    @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.ProductDetailsAfterPictures, additionalData = Model })
</div>
<script asp-location="Footer">
    (function ($) {
        $(document).ready(function () {
           $('.xzoom, .xzoom-gallery').xzoom({ title: true, tint: '#222', Xoffset: 15 });
         //  $('.xzoom, .xzoom-gallery').xzoom({ position: '#xzoom-id', tint: '#222' });
         //   $('.xzoom, .xzoom-gallery').xzoom({ position: 'lens', lensShape: 'circle', sourceClass: 'xzoom-hidden' });


            //Integration with hammer.js
            var isTouchSupported = 'ontouchstart' in window;

            if (isTouchSupported) {
                //If touch device
                $('.xzoom, .xzoom2, .xzoom3, .xzoom4, .xzoom5').each(function () {
                    var xzoom = $(this).data('xzoom');
                    xzoom.eventunbind();
                });

                $('.xzoom, .xzoom2, .xzoom3').each(function () {
                    var xzoom = $(this).data('xzoom');
                    $(this).hammer().on("tap", function (event) {
                        event.pageX = event.gesture.center.pageX;
                        event.pageY = event.gesture.center.pageY;
                        var s = 1, ls;

                        xzoom.eventmove = function (element) {
                            element.hammer().on('drag', function (event) {
                                event.pageX = event.gesture.center.pageX;
                                event.pageY = event.gesture.center.pageY;
                                xzoom.movezoom(event);
                                event.gesture.preventDefault();
                            });
                        }

                        xzoom.eventleave = function (element) {
                            element.hammer().on('tap', function (event) {
                                xzoom.closezoom();
                            });
                        }
                        xzoom.openzoom(event);
                    });
                });

                $('.xzoom').each(function () {
                    var xzoom = $(this).data('xzoom');
                    $(this).hammer().on("tap", function (event) {
                        event.pageX = event.gesture.center.pageX;
                        event.pageY = event.gesture.center.pageY;
                        var s = 1, ls;

                        xzoom.eventmove = function (element) {
                            element.hammer().on('drag', function (event) {
                                event.pageX = event.gesture.center.pageX;
                                event.pageY = event.gesture.center.pageY;
                                xzoom.movezoom(event);
                                event.gesture.preventDefault();
                            });
                        }

                        var counter = 0;
                        xzoom.eventclick = function (element) {
                            element.hammer().on('tap', function () {
                                counter++;
                                if (counter == 1) setTimeout(openfancy, 300);
                                event.gesture.preventDefault();
                            });
                        }

                        function openfancy() {
                            if (counter == 2) {
                                xzoom.closezoom();
                                $.fancybox.open(xzoom.gallery().cgallery);
                            } else {
                                xzoom.closezoom();
                            }
                            counter = 0;
                        }
                        xzoom.openzoom(event);
                    });
                });

                $('.xzoom').each(function () {
                    var xzoom = $(this).data('xzoom');
                    $(this).hammer().on("tap", function (event) {
                        event.pageX = event.gesture.center.pageX;
                        event.pageY = event.gesture.center.pageY;
                        var s = 1, ls;

                        xzoom.eventmove = function (element) {
                            element.hammer().on('drag', function (event) {
                                event.pageX = event.gesture.center.pageX;
                                event.pageY = event.gesture.center.pageY;
                                xzoom.movezoom(event);
                                event.gesture.preventDefault();
                            });
                        }

                        var counter = 0;
                        xzoom.eventclick = function (element) {
                            element.hammer().on('tap', function () {
                                counter++;
                                if (counter == 1) setTimeout(openmagnific, 300);
                                event.gesture.preventDefault();
                            });
                        }

                        function openmagnific() {
                            if (counter == 2) {
                                xzoom.closezoom();
                                var gallery = xzoom.gallery().cgallery;
                                var i, images = new Array();
                                for (i in gallery) {
                                    images[i] = { src: gallery[i] };
                                }
                                $.magnificPopup.open({ items: images, type: 'image', gallery: { enabled: true } });
                            } else {
                                xzoom.closezoom();
                            }
                            counter = 0;
                        }
                        xzoom.openzoom(event);
                    });
                });

            } else {
                //If not touch device

                //Integration with fancybox plugin
                $('#xzoom-fancy-@Model.Id').bind('click', function (event) {
                    var xzoom = $(this).data('xzoom');
                    xzoom.closezoom();
                    $.fancybox.open(xzoom.gallery().cgallery, { padding: 0, helpers: { overlay: { locked: false } } });
                    event.preventDefault();
                });

            }
        });
    })(jQuery);
</script>
